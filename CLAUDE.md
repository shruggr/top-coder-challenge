# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a reverse-engineering challenge for recreating a 60-year-old legacy travel reimbursement system. The goal is to analyze historical input/output data and employee interviews to reconstruct the exact business logic, including any bugs or quirks, of ACME Corp's black box reimbursement system.

## Challenge Structure

The repository contains:
- **Historical data**: `public_cases.json` (1,000 test cases with expected outputs) and `private_cases.json` (5,000 cases without outputs)
- **Documentation**: `PRD.md` (business requirements), `INTERVIEWS.md` (employee insights), `README.md` (challenge overview)
- **Evaluation tools**: `eval.sh` (testing script), `generate_results.sh` (submission generator)
- **Template**: `run.sh.template` (implementation starter)

## Core Challenge Requirements

### Input Parameters
- `trip_duration_days` (integer) - Number of days spent traveling
- `miles_traveled` (integer) - Total miles traveled  
- `total_receipts_amount` (float) - Total dollar amount of receipts

### Output
- Single numeric reimbursement amount (float, rounded to 2 decimal places)

### Implementation Requirements
Your `run.sh` script must:
- Take exactly 3 parameters in the specified order
- Output only a single number (the reimbursement amount)
- Run in under 5 seconds per test case
- Work without external dependencies

## Development Workflow

### 1. Analysis Phase
```bash
# Read the challenge documentation
cat README.md PRD.md INTERVIEWS.md

# Examine test data patterns
head -20 public_cases.json
jq '.[:10]' public_cases.json  # First 10 cases formatted
```

### 2. Implementation Phase
```bash
# Copy template and make executable
cp run.sh.template run.sh
chmod +x run.sh

# Edit run.sh with your calculation logic
# Ensure it outputs only the reimbursement amount
```

### 3. Testing Phase
```bash
# Test against all 1,000 public cases
./eval.sh

# Test individual cases
./run.sh 5 250 150.75  # Should output a single number
```

### 4. Submission Phase
```bash
# Generate results for private cases
./generate_results.sh

# This creates private_results.txt for submission
```

## Key Implementation Insights from Interviews

### Efficiency Bonuses
- System rewards high miles-per-day ratios
- Sweet spot around 180-220 miles per day
- "Efficiency bonus" theory supported by multiple employees

### Trip Duration Patterns
- 5-day trips often get bonuses
- 4-6 day range seems optimal
- Very long trips (8+ days) may get penalties

### Receipt Processing
- Small receipt amounts often penalized
- Diminishing returns on high spending
- Possible rounding quirks with .49/.99 cent amounts
- Optimal spending ranges vary by trip length

### Timing and Randomness
- Possible submission timing effects
- Some randomization to prevent gaming
- System may have learning/adaptation components

### Calculation Paths
- Multiple calculation algorithms based on trip characteristics
- Interaction effects between factors
- Threshold-based bonuses and penalties

## Testing Strategy

### Error Analysis
The `eval.sh` script provides:
- Exact matches (±$0.01)
- Close matches (±$1.00) 
- Average error
- Maximum error cases
- Score calculation

### Performance Metrics
- Target: 95%+ exact matches
- Focus on high-error cases for pattern analysis
- Use interview insights to guide hypothesis testing

## Common Pitfalls

### Output Format
- Must output only a number, no labels or explanations
- Ensure proper floating point precision
- Avoid scientific notation or formatting

### Edge Cases
- Very short trips (1 day)
- Very long trips (8+ days)
- High mileage scenarios
- Low/high receipt amounts
- Zero values in any parameter

## File Dependencies

### Required for Development
- `jq` - JSON parsing in evaluation scripts
- `bc` - Floating point arithmetic in bash
- `public_cases.json` - Training data with expected outputs

### Generated Files
- `run.sh` - Your implementation (copy from template)
- `private_results.txt` - Generated by `generate_results.sh`

## Submission Process

1. Ensure `run.sh` passes evaluation criteria
2. Run `./generate_results.sh` to create `private_results.txt`
3. Submit via Google Form with repository access and results file